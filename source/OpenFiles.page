Menu="SystemInformation"
Type="xmenu"
Title="Open Files"
Icon="folder-open"
Tabs="true"
---
<?PHP
/* Copyright 2015-2023, Dan Landon.
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License version 2,
 * as published by the Free Software Foundation.
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 */

$plugin = "open.files";
$docroot = $docroot ?: @$_SERVER['DOCUMENT_ROOT'] ?: '/usr/local/emhttp';
$translations = file_exists("$docroot/webGui/include/Translations.php");
require_once "$docroot/plugins/$plugin/include/Legacy.php";
?>
<?if (!$translations):?>
<?eval('?>'.parse_file("$docroot/plugins/$plugin/OpenFiles.page"))?>
<?else:?>
<?
require_once("$docroot/plugins/open.files/include/OpenFiles.php");
?>

<table class='tablesorter shift share_status small' id='tblOpenFiles'>
<thead><tr><th width='auto'>_(Process)_</th><th width='auto'>_(Process ID)_</th><th width='auto'>_(Kill Process)_</th><th width='auto'>_(Open Files)_</th><th width='auto'>_(Files that may prevent shutdown)_</th><th width='auto'>_(File Name and Path)_</th></tr></thead>
<tbody id="streams"><?echo(ofiles());?></tbody>
</table>
<p><strong>_(Notes)_:</strong></p>
<li>_(An entry for 'bash' means you have a terminal session open with the working directory on the array)_.</li>
<li>_(If 'smbd' is listed, it means that another computer has a samba share mounted)_. _(Files open by Samba usually won't prevent array shutdown)_.</li>

:open_files_help_plug:
> Click on the **Kill** button to stop the process that is holding the files open.
> A dialog box will open showing you the progress of killing the process holding those files open.
>
> Click on **Process**, **Process ID**, **Files That May Prevent Shutdown**, or **File Name and Path** to change the sort order.
:end

<input type="button" value="_(Refresh)_" onclick="refresh()">
<input type="button" value="_(Done)_" onclick="done()">

<script type="text/javascript">
$(function(){
	$('#tblOpenFiles').tablesorter({headers:{2:{sorter:false},3:{sorter:false}}});
});
</script>
<?endif;?>
